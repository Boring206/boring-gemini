# Pillar V: 認知演進 (深度與批判性思考)

Boring for Gemini V11.0+ 引入了 **「認知演進 (Cognitive Evolution)」**，這是一個從單純的工具執行轉向自主推理與自我優化的範式轉變。這種「Pillar V」架構使 Agent 能夠在行動前進行思考、從錯誤中學習，並即時合成新的能力。

## 🧠 系統二推理 (慢思考)

受到認知科學「雙程運算 (Dual Process)」理論的啟發，Boring 實作了 **「講者-推理者 (Talker-Reasoner)」** 架構：

-   **系統一 (ThinkingState)**：快速、直覺的工具選擇，用於日常例行工作。
-   **系統二 (ReasoningState)**：針對高複雜度任務自動觸發。它整合了 **「批判性思考 (Critical Thinking)」** 循環，在執行更改前先對邏輯進行多輪驗證。

### 觸發機制：`assess_complexity`
`ToolRouter` 會分析您的查詢，檢查：
-   **結構化關鍵字**：例如「重構 (Refactor)」、「架構 (Architecture)」、「設計 (Design)」、「重組 (Restructure)」。
-   **推理提示**：例如「為什麼 (Why)」、「一步步思考 (Think step by step)」、「分析 (Analyze)」。
-   **程式碼密度**：提及多個檔案或高影響力的目標。

---

## ⚡ 主動因果記憶 (Brain Reflex)

傳統的 RAG 尋找的是「相關程式碼」，而 **「Brain Reflex (腦反射)」** 尋找的是「因果解決方案」。

-   **自動回憶**：當 Agent 遇到已知的錯誤（例如：特定的 `ImportError` 或 `AttributeError`）時，它會立即查詢 `BrainManager` 以獲取過去成功的解決方案。
-   **自我修復**：這些解決方案會直接注入到 Prompt 中作為「反射模式 (Reflex patterns)」，防止 Agent 重複犯同樣的錯誤。

---

## 🏗️ 技能萃取 (MAS-to-SAS 彙編)

隨著 Agent 的運作，它會在 `~/.boring_brain/` 中累積許多小型模式。**「技能萃取 (Skill Compilation)」** 會將這些模式濃縮為強大的、單次執行的單元。

-   **工具**：`boring_distill_skills`
-   **過程**：具有高成功率 (`success_count` 預設為 3+) 的模式會被晉升為 **「策略技能 (Strategic Skills)」**。
-   **效益**：技能在系統提示詞中擁有更高的優先級，使 Agent 能夠以「大師級」的效率處理複雜操作。

---

## 🧬 即時工具合成 (Boring Synth)

為什麼要等待外掛更新？Agent 可以編寫自己的工具。

-   **工具**：`boring_synth_tool`
-   **熱重載 (Hot-Reloading)**：Agent 可以生成專門的 Python 腳本，保存到 `.boring_plugins/`，並在單次循環中將其即時加載到活動的 MCP 伺服器中。
-   **使用場景**：建立自定義的專案特定 Linter、數據提取器或專門的重構腳本。

---

## 🌐 知識群 (Knowledge Swarm)

您的本地智能只是故事的一半。**「知識群 (Knowledge Swarm)」** 允許跨不同機器的 Agent 共享彼此的「大腦」。

-   **工具**：`boring_brain_sync`
-   **機制**：使用 Git 從遠端倉庫推送/拉取 `global_patterns.json`。
-   **協作智能**：如果一位開發者修復了一個複雜的部署 Bug，其他所有開發者的 Boring Agent 都會立即獲得該知識。

---

## 🔍 深度分析：認知演進的利與弊

我們對 Pillar V 的核心架構進行了批判性分析，評估其在實際開發中的效益與潛在風險。

### 1. 系統二推理 (System 2 Reasoning)
> **「行動前的思考雖然昂貴，但卻是必要的。」**

*   **優點 (✅)**：
    - **架構忠誠度**：防止 Agent 進行違反專案架構規範的「淺層修復」。
    - **任務分解**：將複雜任務分解為可管理的子任務，減少「上下文漂移」。
    - **穩定性**：大幅減少高複雜度請求中的試錯循環。
*   **缺點 (❌)**：
    - **Token 延遲**：增加了顯著的開銷（推理週期在調用第一個工具前可能消耗 2000+ tokens）。
    - **分析癱瘓**：啟發式評估並不完美；簡單任務（如添加註解）有時可能誤觸發系統二，浪費時間。
    - **成本**：深度推理迭代每次指令的成本是普通模式的 2 到 3 倍。

### 2. 主動因果記憶 (Brain Reflex)
> **「不要重複歷史；直接回憶解決方案。」**

*   **優點 (✅)**：
    - **即時恢復**：如果記憶中存在解決方案，則繞過昂貴的「研究」階段。
    - **自我修復**：自動修正特定環境的怪癖（例如：本地包路徑錯誤）。
    - **信心度**：Agent 提供的修復方案更具信心，因為它們基於本地的成功歷史。
*   **缺點 (❌)**：
    - **陳舊知識**：如果底層代碼已更改但「反射」模式未更新，Agent 可能會重複執行「正確但已過時」的方案。
    - **上下文膨脹**：注入反射模式會消耗 Prompt 的 Token 配額。
    - **錯誤匹配**：過於敏感的語義匹配可能會為看似相似但本質不同的錯誤提供錯誤建議。

### 3. 即時工具合成 (Boring Synth)
> **「透過程式碼進化能力。」**

*   **優點 (✅)**：
    - **無限擴展性**：Agent 不再受限於內建的工具；它可以為特定任務建立專屬工具（例如：解析自定義日誌格式）。
    - **快速原型製作**：熱重載允許 Agent 在不重啟循環的情況下測試和改進自己的能力。
*   **缺點 (❌)**：
    - **安全風險**：合成的工具是 Python 腳本；如果 LLM 產生了破壞性腳本（如 `rm -rf /`），影子模式是唯一的防線。
    - **複雜度洩漏**：每個新工具都會增加 MCP 路由器的負擔。如果不定期清理，路由準確性會下降。

### 4. 知識群 (Knowledge Swarm Sync)
> **「跨集群共享智慧。」**

*   **優點 (✅)**：
    - **協作智能**：一名開發者發現的高質量方案能立即讓整個團隊受益。
    - **一致性**：跨不同專案倉庫標準化「我們如何構建」的範式。
*   **缺點 (❌)**：
    - **數據洩漏風險**：意外導出包含敏感路徑或業務邏輯的模式。
    - **Git 衝突**：由於全域大腦是一個單一的 JSON 檔案，多個專案同時同步可能導致合併衝突。
    - **雜訊**：一個專案中的低質量模式可能會污染全域存儲，降低整體智能準確性。

---

## ⚖️ 最終裁定
認知演進套件是高回報的，但在沒有「影子模式 (Shadow Mode)」和「主動模式萃取」的情況下，**不建議在無人看管的情況下使用**。V13.0.0 成功填補了代碼落差，並將重點轉向了 **「安全性、多代理協作與效能優化」**。
